<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Logistic Regression Practice</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="css/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Logistic Regression Practice
## <br><br> Introduction to Global Health Data Science
### <br> Prof. Amy Herring

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://sta-198-glhlth-298-fall-2022.github.io/website/" target="_blank"&gt;Back to website&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---










class: middle

# Logistic Regression

---

### Data

We consider data from the Global Adult Tobacco Survey (GATS), which is designed to provide nationally-representative data on non-institutionalized people 15 years and older. This survey is a global standard for systematically monitoring adult tobacco use and is produced by the Centers for Disease Control (CDC) in collaboration with the World Health Organization (WHO), RTI International, and Johns Hopkins University.

China has the largest smoking population in the world and accounts for roughly 40% of tobacco consumption worldwide. We will focus on GATS data from China in 2018 (the most recent survey year), but note data from other countries are available from the [WHO's Microdata Repository](https://extranet.who.int/ncdsmicrodata/index.php/home).

---


```r
gats &lt;- readr::read_csv("data/gats_rev.csv")

gats$RESIDENCE=factor(gats$RESIDENCE,levels=c(1,2),labels=c("Urban","Rural"))
gats$PROVINCE=factor(gats$PROVINCE,levels=seq(1:31),labels=c("Beijing","Tianjin","Hebei","Shanxi","Neimenggu","Liaoning","Jilin","Heilongjiang","Shanghai","Jiangsu","Zhejiang","Anhui","Fujian","Jiangxi","Shangdong","Henan","Hubei","Hunan","Guangdong","Guangxi","Hainan","Chongqing","Sichuan","Guizhou","Yunnan","Xizang","Shaanxi","Gansu","Qinghai","Ningxia","Xinjiang"))
gats$REGION6=factor(gats$REGION6,levels=seq(1:6),labels=c("North","North-East","East","South-Central","South-West","North-West"))
gats$REGION3=factor(gats$REGION3,levels=seq(1:3),labels=c("East","Central","West"))
gats$GENDER=factor(gats$GENDER,levels=c(1,2),labels=c("Male","Female"))
gats$CURRENTSMOKE=factor(gats$CURRENTSMOKE,levels=c(1,2,7),labels=c("Yes","No","Don't Know"))
gats$EDUCATION=factor(gats$EDUCATION,levels=c(1,2,3,4,5,6,7,8,77,99),labels=c("None","Less than Primary School","Primary School","Less than Secondary School","Secondary School","High School","University","Postgraduate","Don't Know","Refused"))
gats$OCCUPATION=factor(gats$OCCUPATION,levels=c(1,2,3,4,5,6,7,8,9,10,77,99),labels=c("Farming","Government","Business","Teacher","Healthcare","Student","Soldier","Unemployed","Retired","Other","Don't Know","Refused"))
gats$HEARDOFECIG=factor(gats$HEARDOFECIG,levels=c(1,2,9),labels=c("Yes","No","Refused"))
gats$ECIGUSE=factor(gats$ECIGUSE,levels=c(1,2,3,9),labels=c("Daily","Less than Daily","Not at All","Refused"))
gats$TRYSTOP=factor(gats$TRYSTOP,levels=c(1,2,9),labels=c("Yes","No","Refused"))
gats$HOMESMOKERULES=factor(gats$HOMESMOKERULES,levels=c(1,2,3,4,7,9),labels=c("Allowed","Not Allowed but Exceptions","Never Allowed","No Rules","Don't Know","Refused"))
gats$SMOKESICK=factor(gats$SMOKESICK,levels=c(1,2,7,9),labels=c("Yes","No","Don't Know","Refused"))
gats$SMOKESICKBINARY=ifelse(gats$SMOKESICK=="Yes","Yes","No")
gats$SMOKESICKBINARY=as.factor(gats$SMOKESICKBINARY)
gats$SMOKECANCER=factor(gats$SMOKECANCER,levels=c(1,2,7,9),labels=c("Yes","No","Don't Know","Refused"))
#scale age into decades
gats$DECADES=gats$AGE/10
```

---

Let's explore factors related to a respondent's belief that smoking makes you sick.  First, filter to data to exclude anyone who did not respond to the education question or who reported they didn't know their education level.

Then, conduct some initial exploratory analysis of how the belief smoking makes you sick varies across levels of gender and education. Fit a logistic regression model with gender and education as predictors. Write a paragraph or two describing your findings.

---

### Have aggregate data like counts and/or rates?


```r
# create 0/1 version of SMOKESICKBINARY where 1=yes makes you sick and 0=no
#right now 1=yes and 2=no
gats2 &lt;- gats %&gt;%
  filter(EDUCATION != "Don't Know") %&gt;%
  filter(EDUCATION != "Refused") %&gt;%
  filter(SMOKESICK != "Don't Know") %&gt;%
  filter(SMOKESICK != "Refused")

gats2$SMOKESICKBIN2=ifelse(gats2$SMOKESICKBINARY=="Yes",1,0)

## Turn our data into aggregate counts
## Sickyes = # by gender and education who think smoking makes you sick
## TOTAL: # in each gender and education group (denominator for prevalence)
## Prevalence: probability people in group think smoking makes you sick, calc as Sickyes/TOTAL

## Sickno: TOTAL-Sickyes

gats2_agg &lt;- gats2%&gt;%group_by(GENDER, EDUCATION) %&gt;% 
  summarise(TOTAL=n(), Sickyes=sum(as.numeric(SMOKESICKBIN2))) %&gt;%
  ungroup() %&gt;% 
  mutate(prevalence=Sickyes/TOTAL)


gats2_agg$Sickno &lt;- gats2_agg$TOTAL- gats2_agg$Sickyes
```

---


```r
gats2_agg
```

```
#&gt; # A tibble: 16 × 6
#&gt;   GENDER EDUCATION                  TOTAL Sickyes preval…¹ Sickno
#&gt;   &lt;fct&gt;  &lt;fct&gt;                      &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 Male   None                         308     267    0.867     41
#&gt; 2 Male   Less than Primary School     880     775    0.881    105
#&gt; 3 Male   Primary School              1168    1064    0.911    104
#&gt; 4 Male   Less than Secondary School   522     478    0.916     44
#&gt; 5 Male   Secondary School            2324    2162    0.930    162
#&gt; 6 Male   High School                 1505    1429    0.950     76
#&gt; # … with 10 more rows, and abbreviated variable name ¹​prevalence
```

---

##Now that we have aggregate data, how do we fit the model?


```r
modelagg&lt;-glm(cbind(Sickyes, Sickno) ~
                GENDER+EDUCATION, data=gats2_agg,
              family = binomial)
```

---

Compare this to the output we got from the individual observations!


```r
summary(modelagg)
```

```
#&gt; 
#&gt; Call:
#&gt; glm(formula = cbind(Sickyes, Sickno) ~ GENDER + EDUCATION, family = binomial, 
#&gt;     data = gats2_agg)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -0.81858  -0.16035  -0.00327   0.14003   0.63091  
#&gt; 
#&gt; Coefficients:
#&gt;                                     Estimate Std. Error z value
#&gt; (Intercept)                          1.83277    0.10464  17.516
#&gt; GENDERFemale                         0.80144    0.07161  11.192
#&gt; EDUCATIONLess than Primary School    0.18665    0.12628   1.478
#&gt; EDUCATIONPrimary School              0.51271    0.12693   4.039
#&gt; EDUCATIONLess than Secondary School  0.55071    0.16331   3.372
#&gt; EDUCATIONSecondary School            0.76047    0.11772   6.460
#&gt; EDUCATIONHigh School                 1.08889    0.13740   7.925
#&gt; EDUCATIONUniversity                  1.00133    0.13926   7.191
#&gt; EDUCATIONPostgraduate                0.68403    0.43250   1.582
#&gt;                                     Pr(&gt;|z|)    
#&gt; (Intercept)                          &lt; 2e-16 ***
#&gt; GENDERFemale                         &lt; 2e-16 ***
#&gt; EDUCATIONLess than Primary School   0.139399    
#&gt; EDUCATIONPrimary School             5.36e-05 ***
#&gt; EDUCATIONLess than Secondary School 0.000746 ***
#&gt; EDUCATIONSecondary School           1.05e-10 ***
#&gt; EDUCATIONHigh School                2.28e-15 ***
#&gt; EDUCATIONUniversity                 6.45e-13 ***
#&gt; EDUCATIONPostgraduate               0.113741    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 213.0720  on 15  degrees of freedom
#&gt; Residual deviance:   1.4187  on  7  degrees of freedom
#&gt; AIC: 107.13
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
