---
title: 'Lab #02: Data Visualization'
subtitle: 'due Friday, September 9, 4:00 PM'
output:
  tufte::tufte_html:    
    css: "sta199-labs.css"
    tufte_variant: envisioned
    highlight: pygments
    toc: no
    toc_depth: 1
  html_document:
    toc: no
    toc_depth: '1'
    df_print: paged
link-citations: yes
editor_options:
  chunk_output_type: console
---

## Goals

- Effectively visualize numeric data
- Practice the data science workflow

## Configuring SSH and GitHub

In case you need to generate again the public key, here is a reminder of the steps from last week's lab.

- First, type `credentials::ssh_setup_github()` into your console.
- Second, R will ask "No SSH key found. Generate one now?" You should click 1 for yes.
- Third, you will generate a key. It will begin with "ssh-rsa...." R will then ask "Would you like to open a browser now?" You should click 1 for yes.
- Fourth, you may be asked to provide your username and password to log into GitHub. This would be the ones associated with your account that you set up. After entering this information, you should paste the key in and give it a name.

# Getting started

Go to the course GitHub organization and locate your lab02 repository, which
should have the prefix **lab-02**. Copy the URL of the repository and clone in RStudio. If you have trouble, see last week's lab for step-by-step instructions.

Then, configure git so that RStudio can communicate with GitHub.

Type the following lines of code in the **console** in RStudio filling in your name and the email address associated with your GitHub account.

```{r eval=FALSE}
library(usethis)
use_git_config(user.name = "GitHub username", user.email="your email")
```

Write your answers in the lab02.Rmd template file. Update the YAML header with your name and today's date. Then, knit the document and make sure the resulting 
PDF file has the correct date. Stage, commit, and push your changes.

# Packages

We will be using tidyverse to make plots in R!

```{r load-packages, message = FALSE, echo = FALSE, warning=FALSE}
library(tidyverse)
library(viridis)
library(scales)
```


# World Bank Data

The [World Bank Open Data](https://data.worldbank.org) initiative is a valuable resource for data on a variety of economic, development, population, and health indicators. In this lab we consider the fertility rate in each country or region, defined as the average number of births per woman, from 1960 to 2020. The fertility rate is important in planning and resource allocation, and it often when it is high, access to contraception is limited.  While the replacement level varies a bit based on mortality, a fertility rate of 2.1 is generally accepted as the level at which a population reproduces itself exactly in number from one generation to the next. (Note that a country could still experience population growth with a fertility rate below the replacement level if net immigration is large enough.)

We start by combining data from two Excel files. The first file provides population data from 1960 to 2021 for World Bank regions and countries, and the second file contains the fertility rate for the same entities from 1960-2020.

```{r readdata, echo=FALSE, message=FALSE, warning=FALSE}

library(readxl)

fert=read_excel("worldbank_fertility_1960.2020.xls",sheet=1)

#now pivot to facilitate combination

fertlong <- 
  fert %>%
  select(-c("Indicator Name","Indicator Code")) %>%
  pivot_longer(cols = "1960":"2020", names_to = "Year", values_to = "Fertility Rate")

pop=read_excel("worldbank_population_1960.2021.xls",sheet=1)

poplong <- 
  pop %>%
  select(-c("Indicator Name","Indicator Code")) %>%
  pivot_longer(cols = "1960":"2021", names_to = "Year", values_to = "Population")

#combine the two data sources 
worldbank <- right_join(fertlong,poplong)
worldbank$Year=as.numeric(worldbank$Year)

#restricting to countries, excluding some regions, reporting areas of interest, and semi-autonomous regions

worldbankcountries <- worldbank %>% filter(`Country Name` %in% c("Aruba","Afghanistan","Angola","Albania","Andorra","United Arab Emirates","Argentina","Armenia","American Samoa","Antigua and Barbuda","Australia","Austria","Azerbaijan","Burundi","Belgium","Benin","Burkina Faso","Bangladesh","Bulgaria","Bahrain","The Bahamas","Bosnia and Herzegovina", "Belarus","Belize","Bermuda","Bolivia","Brazil","Barbados","Brunei Darussalam","Bhutan","Botswana","Central African Republic","Canada","Switzerland","Channel Islands","Chile","China","Cote d'Ivoire","Cameroon","Congo, Dem. Rep.","Congo, Rep.","Colombia","Comoros","Cabo Verde","Costa Rica","Cuba","Curacao","Cayman Islands","Cyprus","Czech Republic","Germany","Djibouti","Dominica","Denmark","Dominican Republic","Algeria","Ecuador","Egypt, Arab Rep.","Eritrea","Spain","Estonia","Ethiopia","Finland","Fiji","France","Faroe Islands","Micronesia, Fed. Sts.","Gabon","United Kingdom","Georgia","Ghana","Gibraltar","Guinea","The Gambia","Guinea-Bissau","Equatorial Guinea","Greece","Grenada","Greenland","Guatemala","Guam","Guyana","Honduras","Croatia","Haiti","Hungary","Indonesia","Isle of Man","India","Ireland","Iran, Islamic Rep.","Iraq","Iceland","Israel","Italy","Jamaica","Jordan","Japan","Kazakhstan","Kenya","Kyrgyz Republic","Cambodia","Kiribati","St. Kitts and Nevis","Korea, Rep.","Kuwait","Lao PDR","Lebanon","Liberia","Libya","St. Lucia","Liechtenstein","Sri Lanka","Lesotho","Lithuania","Luxembourg","Latvia","St. Martin","Morocco","Monaco","Moldova","Madagascar","Maldives","Mexico","Marshall Islands","North Macedonia","Mali","Malta","Myanmar","Montenegro","Mongolia","Northern Mariana Islands","Mozambique","Mauritania","Mauritius","Malawi","Malaysia","Namibia","New Caledonia","Niger","Nigeria","Nicaragua","Netherlands","Norway","Nepal","Nauru","New Zealand","Oman","Pakistan","Panama","Peru","Philippines","Palau","Papua New Guinea","Poland","Korea, Dem. People's Rep.","Portugal","Paraguay","French Polynesia","Qatar","Romania","Russian Federation","Rwanda","Saudi Arabia","Sudan","Senegal","Singapore","Solomon Islands","Sierra Leone","El Salvador","San Marino","Somalia","Serbia","South Sudan","Sao Tome and Principe","Suriname","Slovak Republic","Slovenia","Sweden","Eswatini","Sint Maarten","Seychelles","Syrian Arab Republic","Turks and Caicos Islands","Chad","Togo","Thailand","Tajikistan","Turkmenistan","Timor-Leste","Tonga","Trinidad and Tobago","Tunisia","Turkiye","Tuvalu","Tanzania","Uganda","Ukraine","Uruguay","United States","Uzbekistan","St. Vincent and the Grenadines","Venezuela, RB","British Virgin Islands","Virgin Islands (U.S.)","Vietnam","Vanuatu","Samoa","Kosovo","Yemen, Rep.","South Africa","Zambia","Zimbabwe")) 

```

All plots should follow the best visualization practices we have discussed in
lecture. Plots should include an informative title, axes should be labeled, and careful consideration should be given to aesthetic choices.

Your assignment should have at least three meaningful commits.

1. Make a histogram of the 2020 population of the countries. Set the bin width at 100,000,000. Label your axes and give the plot a title. Make sure the axis ticks on the x-axis are not in scientific notation using the scale option *scale_x_continuous(labels = label_comma()) *. Does it appear that there are any outliers (values that are far away from the main body of the data)? If so, what are they (Hint: use the data viewer)?  Does the distribution appear to be symmetric or skewed?


```{r ex1, echo=FALSE, warning=FALSE}


```



2. Sometimes analysts use a *log transformation* in order to bring outliers in the right tail of a distribution closer to its center. Whether or not such a transformation is needed, make a histogram of the log (statisticians use log to indicate the natural log; in the rare cases we want the log base 10, we'll call it log$_{10}$) of the 2020 population of the countries (code to create the log population value is included). As before, label your axes and give the plot a title. Does it appear that there are any outliers in the new plot? If so, what are they?  Does the distribution appear to be symmetric or skewed? Briefly discuss when you might want to use the population histogram on the log scale versus when you might prefer using the original scale.



```{r ex2, message=FALSE, warning=FALSE}


```


*Before going to Exercise 3, now would be a good time to do your first knit and then commit and push.*

3. Filter the data to include China, Jordan, the Republic of Korea, Somalia, the US, and one other country of interest to you. You might want to save the filtered data to a separate dataset, as we'll work with them in subsequent exercises. Generate a scatterplot of `Year` (x-axis) by fertility rate on the y-axis, with points colored by `Country Name` and with size mapped to `Population`. Please label your axes and legend and give the plot a title. 


Describe what you observe in the plot. Do you observe the same pattern for every country?

For the rest of this assignment, *country* will refer just to your 6 selected countries.

```{r ex3, message=FALSE, warning=FALSE}

```


4. Now, examine the relationship between same two variables, with a separate facet for each of your six selected countries. You can drop the size aesthetic if you prefer. Be sure to label your axes. Which plot do you prefer? Briefly explain your choice.

```{r ex4, message=FALSE, warning=FALSE}

```



*Now would be a good time to knit, commit, and push, again.*

5. How has the distribution of fertility rates of countries changed in the last 60 years? Create faceted or side-by-side boxplots all the countries for the years 1960, 1980, 2000, and 2020. Briefly comment on what you notice. 

```{r ex5, warning=FALSE, message=FALSE}


```



*Now would be a good time to knit, commit, and push, again.*

6. Reproduce the plot below. HINT: the Hex color for Duke blue is #00539B.

[Learn more about ggplot2 color options!](http://sape.inf.usi.ch/quick-reference/ggplot2/colour)

```{r ex6, echo=FALSE, warning=FALSE, message=FALSE}

knitr::include_graphics("exercise6")

```


# Submission

Once you are fully satisfied with your lab, **Knit to PDF** to create a PDF document.

**Before you wrap up the assignment, make sure all documents are updated on your GitHub repo. we will be checking these to make sure you have been practicing how to commit and push changes.**

**Remember -- you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.** 

Once your work is finalized in your GitHub repo, you will submit it to Gradescope. **Your assignment must be submitted on Gradescope by the deadline to be considered "on time".**

## Grading
Total: 50 pts

- Exercise 1: 7 pts
- Exercise 2: 7 pts
- Exercise 3: 7 pts
- Exercise 4: 7 pts
- Exercise 5: 7 pts
- Exercise 6: 7 pts
- Overall:  8 pts

  - Overall includes the number of commits made, naming chunks, updating the name on the assignment to your name, following tidyverse style (see: https://style.tidyverse.org/), and in general producing a nicely formatted, neat report. 